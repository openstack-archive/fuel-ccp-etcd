dsl_version: 0.4.0
service:
  name: etcd
  kind: StatefulSet
  ports:
    - {{ etcd.client_port }}
    - {{ etcd.server_port }}
  annotations:
    service:
      prometheus.io/port: "{{ etcd.client_port.cont }}"
      prometheus.io/scrape: "true"
  containers:
    - name: etcd
      image: etcd
      daemon:
        command: /opt/ccp/bin/entrypoint.py
        files:
          - entrypoint
      # {% if etcd.tls.enabled %}
          - server_certificate
          - server_key
      # {% endif %}

files:
  entrypoint:
    path: /opt/ccp/bin/entrypoint.py
    content: entrypoint.py
    perm: "0755"
# {% if etcd.tls.enabled %}
  server_certificate:
    path: /opt/ccp/etc/tls/etcd_server_certificate.pem
    content: server.pem.j2
    perm: "0644"
  server_key:
    path: /opt/ccp/etc/tls/etcd_server_key.pem
    content: server-key.pem.j2
    perm: "0644"
# {% endif %}
